## Модификация клавиатуры под себя в macOS

Для удобства маппинга клавиш и управления правилами мы можем воспользоваться
новой утилитой
[Karabiner-Elements](https://github.com/tekezo/Karabiner-Elements), которая
доступна под macOS Sierra (10.12) и выше. Существовала более старая версия без
приставки `Elements` для устаревших ОС, но здесь мы ее рассматривать не будем.

Маппинги в Karabiner-Elements можно разделить на две большие группы: Simple и
Complex Modification. Для первых характерно простое переназначение с одной клавиши на
другую (From key To key), дополнительно используя возможности
клавиш-модификаторов или не учитывая их. Кроме того, в простейших случаях в
текущей версии программы можно выполнять сопоставление клавиш прямо через GUI.
Для комплексных модификаций вам в любом случае придется описывать правила в
формате JSON.

Настоятельно рекомендую обратить внимание на встроенную в Karabiner-Elements
утилиту `EventViewer`, которая поможет понять как называются в вашей системе те
или иные клавиши и поможет получить уже готовые сниппеты для ваших
конфигурационных файлов.

Рассмотрим простое правило, описанное в формате JSON:

```json
{
    "from": {
        "key_code": "d",
        "modifiers": {
            "mandatory": [
                "left_gui",
                "left_alt"
            ],
            "optional": [
                "any"
            ]
        }
    },
    "to": [
        {
            "key_code": "f1"
        }
    ],
    "type": "basic"
}
```

Давайте взглянем на главный конфигурационный файл
`~/.config/karabiner/karabiner.json`, который содержит все активированные
правила (поэтому он может быть достаточно большим). Мы можем его
отредактировать и добавить свои дополнения. Этот файл автоматически
перегружается программой Karabiner-Elements при изменении, таким образом мы
легко сможем протестировать свои догадки. В случае каких-либо проблем нам также
окажет неоценимую помощь вкладка `Log`, которая сообщениями красного цвета
отобразит некорректные значения или ошибки в конфигурации или же другие проблемы
с вашими модификациями.

Начать ее изучение синтаксиса конфигурационных файлов нужно с
[документации](https://pqrs.org/osx/karabiner/json.html), следуя которой можно
попробовать облегчить себе жизнь и сразу внедрить пару "приемчиков". Давайте
рассмотрим пример, когда у нас есть две раскладки клавиатуры (английская и
русская) и мы хотим во-первых организовать переключение с использованием только
одной кнопки для каждого случая, а во-вторых - реализовать идемпотентное их
переключение.

На роль подопытных клавиш мы выберем левый и правый Command, что позволит плавно
отказаться от подобного переключения с помощью системной комбинации клавиш
(фактически нажимаем все то же самое, но без необходимости тянуться к пробелу).

Давайте в EventViewer во первой вкладке `Main` понажимаем оба Command и
определим их правильные названия для конфигурационного файла. Во вкладке
`Variables` доступны подсказки с наименованием текущей раскладки клавиатуры
`com.apple.keylayout.чего_то_там`, которые нам также в дальнейшем понадобятся.

Для выполнения нашего упражнения кроме чтения документации вам, вероятно, может
понадобиться
[подсказка](https://github.com/pqrs-org/KE-complex_modifications/blob/master/src/json/example_select_input_source.json.erb),
однако настоятельно рекомендую воспользоваться ей только после того, как ваши
эксперименты зайдут в тупик.

### Домашние задания

Найдите на странице документации и разберите примеры:
1. Как инвертировать символы `;` и `:` на их кнопке?
2. Как сделать `Ctrl-H` аналогом `Backspace` и `Ctrl-Opt-H` аналогом `Delete`?
3. Запретить использование `Cmd-l` в приложении Finder
4. При нажатии клавиши `LCtrl` без комбинаци с другой выдавать `Escape`
5. Открывать заданное приложение при удерживании клавиши `Escape`
6. При двойном нажатии правого `Shift` запускать приложение `Mission Control`
7. При одновременном нажатии клавиш `=` и `Delete` выполнять функцию прямого
   `Delete`?

Внедрите пару из описанных приемов в свой рабочий процесс.

